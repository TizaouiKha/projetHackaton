<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<app-sidebar-toggle (click)="sideNav.toggle(); showMessages()" class="matSideToggle"></app-sidebar-toggle>
<mat-sidenav-container>
    <mat-sidenav #sideNav mode="side" position="end" (opened)="showMessages();" (closed)="showMessages()" [class.mat-elevation-z4]>
        
        <div class="example-container">
            <div *ngIf="isPractitioner == 1" class="button-group">
                <button class="top-button" id="allButton" (click)="toggleMessages(false)" [ngClass]="{'active': showAllMessages}">Tous</button>
                <button class="top-button" id="proButton" (click)="toggleMessages(true)" [ngClass]="{'active': !showAllMessages}">Entre Pro</button>
            </div>
            <!-- Affichage des messages filtrés -->
            <div class="chat-container">
                <div *ngFor="let message of messages" [ngClass]="{'hidden':  message.type==1 && isPractitioner==0 || !showAllMessages && message.type==null && isPractitioner==1 }">
                    <div class="chat-message" [ngClass]="{'pro':isPractitioner==1, 'patient':  isPractitioner==0}">
                        <div class="chat-bubble">
                            <p *ngIf="message.name" class="chat-name">{{message.name}}</p>
                            <p class="chat-text">{{message.content}}</p>
                            <div class="timestamp-container">
                                <p class="chat-timestamp">{{message.timestamp}}</p>
                                <span *ngIf="message.type === 1" class="pro-tag">ENTRE PRO</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div *ngIf="!showAllMessages" class="date-line">
              <span class="date-text">Lundi 21 novembre 2023</span>
          </div>
            <!-- Conteneur de saisie de message toujours visible -->
            <div class="message-container">
                <form #addForm="ngForm" (ngSubmit)="onAddCommunication(addForm)">
                <div *ngIf="isPractitioner==1">
                    <label for="">Destinataire</label>
                    <select name="isEntrePro" id="recipient">
                        <option [ngModel]="0" value="everyone">Tout le monde</option>
                        <option [ngModel]="1" value="everyone">Aux pros</option>
                    </select>
                </div>
                <div *ngIf="isPractitioner==0">
                    <input  [ngModel]="1" type="hidden" name="isEntrePro" [value]="1">
                </div>
                    
                    <input [ngModel]="careTeam?.id" type="hidden" name="idCareTeam" [value]="10">
                    <input [ngModel]="userId" type="hidden" name="idSender" [value]="userId">
                    <input [ngModel]="null" type="hidden" name="fileMsg" [value]="null">
                    <input [ngModel]="this.time" type="hidden" name="dateSent" [value]="this.time">
                    <input [ngModel]="this.time" type="hidden" name="dateReceived" [value]="this.time">
                    <input [ngModel]="" type="text" name="textMsg" required>
                    <div class="notification-toggle">
                        <mat-slide-toggle id="notify-pros" color="primary">Avec notification aux pros</mat-slide-toggle>
                        
                        <button type="submit" class="send-message">Envoyer</button>
                    </div>
                </form>
                
            </div>
        </div>
    </mat-sidenav>
      <mat-sidenav-content>
          <p>accueil works!</p>
          <h1>Placer ici les infos de base et le chat</h1>
          <button (click)="deconnexion()">Déconnexion</button>
          <h1>Steto </h1>
<div *ngIf="isPractitioner==1">
    <form>
        <label for="userSelect">Choisir un patient : </label>
        <select id="userSelect" name="userSelect" [(ngModel)]="selectedPatient" (change)="onPatientChange()" [selectedIndex]="1">
        <option *ngFor="let patient of patients; let i = index" [ngValue]="patient" [attr.selected]='i==0 ? "selected" : true'>{{ patient.firstName }} {{ patient.lastName }}</option>
        </select>
    </form>
</div>
          <div name="infosPatient">
            <div *ngFor="let patient of patients" [ngClass]="{ 'selected': patient.id === this.idPatient}">
                <div *ngIf="this.idPatient === patient.id">
                    <div name="nomPrenom">{{ patient.firstName }} {{ patient.lastName }}</div>
                    <div name="email">Email du patient : {{ patient.email }}</div>
                    <div name="diabetesType">Type de diabete : {{ patient.diabetesType }}</div>
                    <div name="insulinScheme">Schéma d'insuline : {{ patient.insulinScheme }}</div>
                    <br>
                    <div name="chatById">Afficher à droite le chat avec la careTeam du patient selectionné dans la liste </div>
                    <br>
                </div>
            </div>
        </div>
      </mat-sidenav-content>
  </mat-sidenav-container>